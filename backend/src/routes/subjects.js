import express from 'express';import Subject from '../models/Subject.js';import auth from '../middleware/auth.js';const r=express.Router();r.use(auth);r.get('/',async(req,res)=>{res.json(await Subject.find({userId:req.user.id}).sort({updatedAt:-1}))});r.get('/:id',async(req,res)=>{const s=await Subject.findOne({_id:req.params.id,userId:req.user.id});if(!s)return res.status(404).json({error:'Not found'});res.json(s)});r.post('/',async(req,res)=>{const {name,isLab}=req.body;if(!name)return res.status(400).json({error:'Name required'});res.json(await Subject.create({userId:req.user.id,name,isLab:!!isLab}))});r.patch('/:id',async(req,res)=>{const {name,targetPct,attended,total,isLab}=req.body;const s=await Subject.findOne({_id:req.params.id,userId:req.user.id});if(!s)return res.status(404).json({error:'Not found'});if(name!==undefined)s.name=name;if(targetPct!==undefined)s.targetPct=targetPct;if(attended!==undefined)s.attended=attended;if(total!==undefined)s.total=total;if(isLab!==undefined)s.isLab=!!isLab;await s.save();res.json(s)});r.delete('/:id',async(req,res)=>{await Subject.deleteOne({_id:req.params.id,userId:req.user.id});res.json({ok:true})});export default r
